<div class="dashboard-wrapper">
    <!-- Print-Only Professional Header -->
    <div class="print-only-header">
        <div class="print-brand">
            <span class="brand-logo">SnapCart</span>
            <span class="report-title">Analytical Performance Report</span>
        </div>
        <div class="print-metadata">
            <div class="meta-item"><strong>Generated On:</strong> {{ today | date:'medium' }}</div>
            <div class="meta-item"><strong>Report Range:</strong> {{ selectedRange() | titlecase }}</div>
            <div class="meta-item"><strong>Role:</strong> Moderator</div>
        </div>
    </div>

    <!-- Print-Only Summary Table -->
    <div class="print-summary-section">
        <h3>Executive Summary</h3>
        <table class="summary-table">
            <thead>
                <tr>
                    <th>Metric</th>
                    <th>Current Value</th>
                    <th>Status</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td>Total Revenue</td>
                    <td class="fw-bold">{{ summary()?.totalRevenue | currency:'INR':'symbol':'1.0-0' }}</td>
                    <td>Achieved</td>
                </tr>
                <tr>
                    <td>Total Orders</td>
                    <td class="fw-bold">{{ summary()?.totalOrders }}</td>
                    <td>Verified</td>
                </tr>
                <tr>
                    <td>New Customers</td>
                    <td class="fw-bold">{{ summary()?.newCustomers }}</td>
                    <td>Active</td>
                </tr>
                <tr>
                    <td>Avg Order Value</td>
                    <td class="fw-bold">{{ summary()?.avgOrderValue | currency:'INR':'symbol':'1.0-0' }}</td>
                    <td>Optimized</td>
                </tr>
            </tbody>
        </table>
    </div>

    <div class="dashboard-header">
        <div class="header-content">
            <h1>Dashboard</h1>
            <p>Welcome back, Moderator</p>
        </div>

        <div class="controls">
            <button mat-flat-button color="accent" class="print-btn" (click)="printReport()" [disabled]="loading()">
                <mat-icon>print</mat-icon> Print Report
            </button>
            <mat-form-field appearance="outline" class="range-selector">
                <mat-select [value]="selectedRange()" (selectionChange)="onRangeChange($event.value)">
                    <mat-option value="daily">Daily</mat-option>
                    <mat-option value="weekly">Weekly</mat-option>
                    <mat-option value="monthly">Monthly</mat-option>
                    <mat-option value="yearly">Yearly</mat-option>
                </mat-select>
            </mat-form-field>
        </div>
    </div>

    @if (loading()) {
    <div class="loading-state">
        <mat-spinner diameter="40"></mat-spinner>
        <p>Loading analytics...</p>
    </div>
    } @else {

    <!-- Quick Management Section -->
    <div class="section-container">
        <h2 class="section-title">Quick Management</h2>

        <div class="cards-grid">
            <div class="action-card" *ngFor="let card of cards" (click)="navigate(card.link)">
                <div class="card-content">
                    <div class="icon-circle" [ngClass]="getIconClass(card.icon)">
                        <mat-icon>{{card.icon}}</mat-icon>
                    </div>
                    <div class="text-content">
                        <h3>{{card.title}}</h3>
                        <p>{{card.description}}</p>
                    </div>
                    <div class="arrow-container">
                        <mat-icon>chevron_right</mat-icon>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Analytics Section -->
    <div class="section-container">
        <h2 class="section-title">Analytics Overview</h2>

        <!-- Summary Metrics -->
        <div class="summary-grid">
            <div class="metric-card revenue">
                <div class="metric-icon">
                    <mat-icon>attach_money</mat-icon>
                </div>
                <div class="metric-info">
                    <span class="label">Total Revenue</span>
                    <span class="value">{{ summary()?.totalRevenue | currency:'INR':'symbol':'1.0-0' }}</span>
                </div>
            </div>

            <div class="metric-card orders">
                <div class="metric-icon">
                    <mat-icon>shopping_bag</mat-icon>
                </div>
                <div class="metric-info">
                    <span class="label">Total Orders</span>
                    <span class="value">{{ summary()?.totalOrders }}</span>
                </div>
            </div>

            <div class="metric-card customers">
                <div class="metric-icon">
                    <mat-icon>group</mat-icon>
                </div>
                <div class="metric-info">
                    <span class="label">New Customers</span>
                    <span class="value">{{ summary()?.newCustomers }}</span>
                </div>
            </div>

            <div class="metric-card aov">
                <div class="metric-icon">
                    <mat-icon>trending_up</mat-icon>
                </div>
                <div class="metric-info">
                    <span class="label">Avg Order Value</span>
                    <span class="value">{{ summary()?.avgOrderValue | currency:'INR':'symbol':'1.0-0' }}</span>
                </div>
            </div>
        </div>

        <!-- Charts Grid -->
        <div class="charts-grid">
            <!-- Revenue Growth (Full Width) -->
            <div class="chart-container wide">
                <div class="chart-header">
                    <h3>Revenue Growth</h3>
                    <button mat-icon-button color="primary" (click)="downloadChart('revenueChart', 'revenue_growth')"
                        title="Download Chart">
                        <mat-icon>download</mat-icon>
                    </button>
                </div>
                <div class="chart-body">
                    <canvas id="revenueChart" baseChart [data]="revenueChartData" [options]="lineChartOptions"
                        [type]="'line'">
                    </canvas>
                </div>
            </div>

            <!-- Order Volume (Half Width) -->
            <div class="chart-container">
                <div class="chart-header">
                    <h3>Order Volume</h3>
                    <button mat-icon-button color="primary" (click)="downloadChart('ordersChart', 'order_volume')"
                        title="Download Chart">
                        <mat-icon>download</mat-icon>
                    </button>
                </div>
                <div class="chart-body">
                    <canvas id="ordersChart" baseChart [data]="ordersChartData" [options]="barChartOptions"
                        [type]="'bar'">
                    </canvas>
                </div>
            </div>

            <!-- Sales by Category (Half Width) -->
            <div class="chart-container">
                <div class="chart-header">
                    <h3>Sales by Category</h3>
                    <button mat-icon-button color="primary"
                        (click)="downloadChart('categoryChart', 'sales_by_category')" title="Download Chart">
                        <mat-icon>download</mat-icon>
                    </button>
                </div>
                <div class="chart-body">
                    <canvas id="categoryChart" baseChart [data]="categoryChartData" [options]="pieChartOptions"
                        [type]="'pie'">
                    </canvas>
                </div>
            </div>
        </div>
    </div>
    }
</div>