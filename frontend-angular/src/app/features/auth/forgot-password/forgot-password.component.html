<div class="forgot-wrapper">
    <!-- Animated Background Elements -->
    <div class="bg-circle red"></div>
    <div class="bg-circle purple"></div>

    <!-- Header -->
    <header class="page-header">
        <div class="logo">
            <mat-icon>directions_run</mat-icon>
            <span class="brand-name">SnapCart</span>
        </div>
        <button mat-button routerLink="/login" class="back-btn">
            <mat-icon>arrow_back</mat-icon>
            Back to Login
        </button>
    </header>

    <main class="container">
        <mat-card class="forgot-card">
            <div class="card-header">
                <h2>Forgot Password?</h2>
                <p class="subtitle">Follow the steps to reset your password</p>
            </div>

            <mat-stepper [selectedIndex]="activeStep" #stepper alternativeLabel class="custom-stepper">
                <mat-step [editable]="false" label="Enter Email"></mat-step>
                <mat-step [editable]="false" label="Verify OTP"></mat-step>
                <mat-step [editable]="false" label="Reset Password"></mat-step>
            </mat-stepper>

            <div class="step-content">
                <!-- Step 0: Enter Email -->
                @if (activeStep === 0) {
                <form [formGroup]="emailForm" (ngSubmit)="sendOtp()">
                    <mat-form-field appearance="outline" class="full-width custom-field">
                        <mat-label>Email Address</mat-label>
                        <mat-icon matPrefix>email</mat-icon>
                        <input matInput type="email" formControlName="email" placeholder="example@mail.com" required />
                    </mat-form-field>
                    <button mat-raised-button color="primary" class="action-btn" type="submit"
                        [disabled]="loading || emailForm.invalid">
                        @if (loading) { <mat-progress-spinner diameter="24" mode="indeterminate" /> } @else { Send OTP }
                    </button>
                </form>
                }

                <!-- Step 1: Verify OTP -->
                @if (activeStep === 1) {
                <form [formGroup]="otpForm" (ngSubmit)="verifyOtp()">
                    <p class="info-text">We sent a 6-digit code to <strong>{{ email }}</strong></p>
                    <mat-form-field appearance="outline" class="full-width custom-field">
                        <mat-label>Enter OTP</mat-label>
                        <mat-icon matPrefix>confirmation_number</mat-icon>
                        <input matInput formControlName="otp" placeholder="123456" maxlength="6" required />
                    </mat-form-field>
                    <div class="button-group">
                        <button mat-raised-button color="primary" class="action-btn" type="submit"
                            [disabled]="loading || otpForm.invalid">
                            @if (loading) { <mat-progress-spinner diameter="24" mode="indeterminate" /> } @else { Verify
                            Code }
                        </button>
                        <button mat-button type="button" (click)="activeStep = 0" class="minor-btn">Change
                            Email</button>
                    </div>
                </form>
                }

                <!-- Step 2: Reset Password -->
                @if (activeStep === 2) {
                <form [formGroup]="resetForm" (ngSubmit)="resetPassword()">
                    <mat-form-field appearance="outline" class="full-width custom-field">
                        <mat-label>New Password</mat-label>
                        <mat-icon matPrefix>lock</mat-icon>
                        <input matInput type="password" formControlName="newPassword" placeholder="8+ characters"
                            required />
                    </mat-form-field>
                    <mat-form-field appearance="outline" class="full-width custom-field">
                        <mat-label>Confirm Password</mat-label>
                        <mat-icon matPrefix>lock</mat-icon>
                        <input matInput type="password" formControlName="confirmPassword" placeholder="Repeat password"
                            required />
                    </mat-form-field>
                    <button mat-raised-button color="primary" class="action-btn" type="submit"
                        [disabled]="loading || resetForm.invalid">
                        @if (loading) { <mat-progress-spinner diameter="24" mode="indeterminate" /> } @else { Reset
                        Password }
                    </button>
                </form>
                }
            </div>
        </mat-card>
    </main>
</div>